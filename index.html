<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Sistema de Evolu√ß√£o e Admiss√£o CTI - HNSS / Intensivale">
<meta name="theme-color" content="#1565c0">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè•</text></svg>">
<title>Pass√¥metroUTI - Sistema de Evolu√ß√£o CTI</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 40px;
  background: #fff;
  color: #111;
}
.section{
  border: 1px solid #ccc;
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto 20px auto;
  border-radius: 8px;
  background-color: #f9f9f9;
}
.row{
  display: flex;
  gap: 20px;
  align-items: center;
  margin-bottom: 14px;
  flex-wrap: wrap;
}
.row.nowrap{ flex-wrap: nowrap; }
label{
  display: flex;
  flex-direction: column;
  min-width: 140px;
}
input, select, textarea{
  padding: 6px;
  font-size: 14px;
  border: 1px solid #bbb;
  border-radius: 4px;
}
textarea{ width: 100%; resize: vertical; }
.hidden{ display:none !important; }

button{
  padding: 10px 16px;
  font-size: 15px;
  border: 1px solid #777;
  border-radius: 6px;
  background: #f2f2f2;
  cursor: pointer;
}

.topo {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
}

.topo img {
  height: 70px;
}
</style>
</head>

<body>

<!-- TOPO -->
<div class="topo">
  <img src="HNSS.jpeg" alt="HNSS">
  <h1 style="flex:1; text-align:center; margin:0;">Admiss√£o CTI Adulto</h1>
  <img src="intensivale.png" alt="Intensivale">
</div>

<!-- LOGIN -->
<div class="section" id="loginArea">
  <h3>Login</h3>
  <div class="row">
    <label>Email
      <input type="email" id="loginEmail">
    </label>
    <label>Senha
      <input type="password" id="loginPassword">
    </label>
    <button onclick="login()">Entrar</button>
  </div>
</div>

<!-- SELETOR DE LEITO -->
<div class="section hidden" id="seletorArea">
  <h3>Selecionar Leito</h3>
  <div class="row">
    <label>Leito
      <select id="seletorLeito" onchange="carregarLeito()">
        <option value="">Selecione</option>
        <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
      </select>
    </label>
  </div>
</div>

<!-- ADMISS√ÉO -->
<div class="section hidden" id="admissaoArea">
  <h3>Identifica√ß√£o</h3>
  <div class="row">
    <label>Nome
      <input name="nome">
    </label>
    <label>Idade
      <input name="idade">
    </label>
    <label>Sexo
      <select name="sexo">
        <option></option>
        <option value="M">Masculino</option>
        <option value="F">Feminino</option>
      </select>
    </label>
    <label>Data/hora admiss√£o
      <input type="datetime-local" name="datahora_admissao">
    </label>
  </div>

  <div class="row">
    <label style="flex:1;">HMA
      <textarea name="hma" rows="3"></textarea>
    </label>
  </div>

  <button onclick="salvarLeito()">Salvar admiss√£o</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB7Mt4NsiXOam36i5MgClhKa-IOimlQ4DE",
  authDomain: "gestaoutihnss.firebaseapp.com",
  projectId: "gestaoutihnss",
  storageBucket: "gestaoutihnss.firebasestorage.app",
  messagingSenderId: "664272211913",
  appId: "1:664272211913:web:66e30e6670126b3e51a218",
  measurementId: "G-K0ZB5KLRGY"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let leitoAtual = null;

window.login = function() {
  signInWithEmailAndPassword(auth,
    document.getElementById('loginEmail').value,
    document.getElementById('loginPassword').value
  ).catch(e => alert(e.message));
}

onAuthStateChanged(auth, user => {
  if (user) {
    document.getElementById('loginArea').classList.add('hidden');
    document.getElementById('seletorArea').classList.remove('hidden');
  }
});

window.carregarLeito = async function() {
  leitoAtual = document.getElementById('seletorLeito').value;
  if (!leitoAtual) return;

  document.getElementById('admissaoArea').classList.remove('hidden');

  const ref = doc(db, "leitos", "UTI_" + leitoAtual);
  const snap = await getDoc(ref);
  if (snap.exists()) {
    const d = snap.data();
    document.querySelectorAll('[name]').forEach(el=>{
      if(d[el.name]) el.value = d[el.name];
    });
  }
}

window.salvarLeito = async function() {
  if (!leitoAtual) return;
  let dados = {};
  document.querySelectorAll('[name]').forEach(el=>{
    dados[el.name] = el.value;
  });
  await setDoc(doc(db, "leitos", "UTI_" + leitoAtual), dados);
  alert("Salvo com sucesso");
}
</script>

</body>
</html>
