<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Pass√¥metroUTI - Sistema de Evolu√ß√£o - HNSS">
<meta name="theme-color" content="#1565c0">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè•</text></svg>">
<title>Pass√¥metroUTI - Sistema de Evolu√ß√£o | HNSS</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; color: #111; }
.header { background: linear-gradient(135deg, #1a7a6f, #0d5047); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
.header-logos { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 15px; }
.header-logos img { height: 50px; max-width: 120px; background: white; padding: 5px; border-radius: 8px; object-fit: contain; }
.header h1 { font-size: 28px; margin-bottom: 5px; }
.header p { opacity: 0.9; }
.nav-buttons { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
.nav-buttons button { padding: 10px 20px; background: #1a7a6f; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
.nav-buttons button:hover { background: #0d5047; transform: translateY(-2px); }
.section { border: 1px solid #ccc; padding: 20px; max-width: 1200px; margin: 0 auto 20px auto; border-radius: 8px; background-color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.section h3 { color: #0d5047; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #1a7a6f; }
.row { display: flex; gap: 20px; align-items: center; margin-bottom: 14px; flex-wrap: wrap; }
label { display: flex; flex-direction: column; min-width: 140px; }
label span { font-weight: 600; margin-bottom: 5px; color: #333; }
input, select, textarea { padding: 8px; font-size: 14px; border: 1px solid #bbb; border-radius: 4px; font-family: inherit; }
input:focus, select:focus, textarea:focus { border-color: #1a7a6f; outline: none; }
input[readonly] { background: #eaeaea; }
textarea { width: 100%; resize: vertical; min-height: 80px; }
button { padding: 10px 16px; font-size: 15px; border: none; border-radius: 6px; background: #1a7a6f; color: white; cursor: pointer; transition: all 0.3s; }
button:hover { background: #0d5047; }
button.secondary { background: #757575; }
button.secondary:hover { background: #424242; }
button.danger { background: #c62828; }
button.danger:hover { background: #8e0000; }
.divider { margin-top: 22px; border-top: 3px solid #e5e7eb; padding-top: 14px; }
.hidden { display: none !important; }
#status_save, #status_evo_save { margin-top: 10px; padding: 10px; border-radius: 6px; display: none; }
#status_save.success, #status_evo_save.success { background: #c8e6c9; color: #2e7d32; display: block; }
#status_save.error, #status_evo_save.error { background: #ffcdd2; color: #c62828; display: block; }
#evoHistoryList { max-height: 400px; overflow-y: auto; }
.evo-item { border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; margin: 8px 0; background: #f9f9f9; }
.evo-item h4 { color: #0d5047; margin-bottom: 8px; }
.evo-item p { margin: 5px 0; color: #666; }
.evo-actions { display: flex; gap: 10px; margin-top: 10px; }
@media print {
    button, .no-print, #evoHistoryList, .section h3, #status_save, #status_evo_save, .nav-buttons, .evo-actions { display: none !important; }
    input, textarea, select { border: none !important; background: transparent !important; resize: none; padding: 0; font-weight: bold; color: #000; }
    .section { border: none !important; box-shadow: none !important; margin: 0 !important; padding: 5px 0 !important; page-break-inside: avoid; }
    body { margin: 0; padding: 0; font-size: 11pt; background: white !important; }
}
</style>
</head>
<body>

<div class="header">
    <div class="header-logos">
        <img src="img/HNSS.jpg" alt="Hospital Nossa Senhora da Sa√∫de" onerror="this.style.display='none'">
        <img src="img/intensivale.jpeg" alt="Intensivale" onerror="this.style.display='none'">
    </div>
    <h1>üè• Pass√¥metroUTI</h1>
    <p>Sistema de Evolu√ß√£o e Admiss√£o - Hospital Nossa Senhora da Sa√∫de</p>
</div>

<div class="nav-buttons">
    <button onclick="window.location.href='index.html'">‚Üê Voltar para Gest√£o</button>
    <button onclick="window.location.href='solicitacaocti.html'">üìã Solicitar Vaga</button>
    <button onclick="mostrarSecao('admissao')">üë§ Nova Admiss√£o</button>
    <button onclick="mostrarSecao('evolucao')">üìù Evolu√ß√£o</button>
    <button onclick="mostrarSecao('historico')">üìö Hist√≥rico</button>
    <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
</div>

<!-- SE√á√ÉO ADMISS√ÉO -->
<div class="section" id="secao_admissao">
    <h3>üë§ Admiss√£o de Paciente na UTI</h3>
    
    <div class="row">
        <label><span>Nome do Paciente:</span><input type="text" id="nome_pac" placeholder="Nome completo"></label>
        <label><span>Idade:</span><input type="number" id="idade_pac" min="0" max="150"></label>
        <label><span>Data de Admiss√£o:</span><input type="date" id="data_admissao"></label>
    </div>
    
    <div class="row">
        <label><span>Leito UTI:</span>
            <select id="leito_pac">
                <option value="">Selecione...</option>
                <option value="1">Leito 01</option>
                <option value="2">Leito 02</option>
                <option value="3">Leito 03</option>
                <option value="4">Leito 04</option>
                <option value="5">Leito 05</option>
                <option value="6">Leito 06</option>
                <option value="7">Leito 07</option>
                <option value="8">Leito 08</option>
                <option value="9">Leito 09</option>
                <option value="10">Leito 10</option>
            </select>
        </label>
    </div>
    
    <div class="row">
        <label><span>Diagn√≥stico de Admiss√£o:</span></label>
    </div>
    <div class="row">
        <textarea id="diagnostico_adm" placeholder="Diagn√≥stico principal e comorbidades"></textarea>
    </div>
    
    <div class="row">
        <label><span>Plano Terap√™utico Inicial:</span></label>
    </div>
    <div class="row">
        <textarea id="plano_inicial" placeholder="Condutas iniciais, medica√ß√µes, suporte"></textarea>
    </div>
    
    <div class="divider"></div>
    
    <div class="row">
        <button onclick="salvarAdmissao()">üíæ Salvar Admiss√£o</button>
        <button class="secondary" onclick="limparFormAdmissao()">üîÑ Limpar</button>
    </div>
    
    <div id="status_save"></div>
</div>

<!-- SE√á√ÉO EVOLU√á√ÉO -->
<div class="section hidden" id="secao_evolucao">
    <h3>üìù Evolu√ß√£o Di√°ria</h3>
    
    <div class="row">
        <label><span>Selecionar Paciente:</span>
            <select id="sel_paciente" onchange="carregarDadosPaciente()">
                <option value="">Selecione um paciente...</option>
            </select>
        </label>
        <label><span>Data da Evolu√ß√£o:</span><input type="date" id="data_evo"></label>
    </div>
    
    <div class="row">
        <label><span>Nome:</span><input type="text" id="nome_evo" readonly></label>
        <label><span>Leito:</span><input type="text" id="leito_evo" readonly></label>
        <label><span>Dias de Interna√ß√£o:</span><input type="text" id="dias_internacao" readonly></label>
    </div>
    
    <div class="divider"></div>
    
    <div class="row">
        <label><span>Estado Geral:</span>
            <select id="estado_geral">
                <option value="">Selecione...</option>
                <option value="Est√°vel">Est√°vel</option>
                <option value="Melhorando">Melhorando</option>
                <option value="Inalterado">Inalterado</option>
                <option value="Piorando">Piorando</option>
                <option value="Grave">Grave</option>
            </select>
        </label>
    </div>
    
    <div class="row">
        <label><span>Sinais Vitais:</span></label>
    </div>
    <div class="row">
        <label><span>PA:</span><input type="text" id="pa" placeholder="Ex: 120x80"></label>
        <label><span>FC:</span><input type="number" id="fc" placeholder="bpm"></label>
        <label><span>FR:</span><input type="number" id="fr" placeholder="irpm"></label>
        <label><span>Temp:</span><input type="text" id="temp" placeholder="¬∞C"></label>
        <label><span>SatO‚ÇÇ:</span><input type="number" id="sat" placeholder="%"></label>
    </div>
    
    <div class="divider"></div>
    
    <div class="row">
        <label><span>Evolu√ß√£o Cl√≠nica:</span></label>
    </div>
    <div class="row">
        <textarea id="evolucao_clinica" placeholder="Descreva a evolu√ß√£o do paciente nas √∫ltimas 24h"></textarea>
    </div>
    
    <div class="row">
        <label><span>Conduta / Plano:</span></label>
    </div>
    <div class="row">
        <textarea id="conduta" placeholder="Condutas e plano terap√™utico"></textarea>
    </div>
    
    <div class="divider"></div>
    
    <div class="row">
        <button onclick="salvarEvolucao()">üíæ Salvar Evolu√ß√£o</button>
        <button class="secondary" onclick="limparFormEvolucao()">üîÑ Limpar</button>
    </div>
    
    <div id="status_evo_save"></div>
</div>

<!-- SE√á√ÉO HIST√ìRICO -->
<div class="section hidden" id="secao_historico">
    <h3>üìö Hist√≥rico de Evolu√ß√µes</h3>
    
    <div class="row">
        <label><span>Filtrar por Paciente:</span>
            <select id="filtro_paciente" onchange="carregarHistorico()">
                <option value="">Todos os pacientes</option>
            </select>
        </label>
    </div>
    
    <div id="evoHistoryList"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

<script>
// ========== CONFIGURA√á√ÉO FIREBASE ==========
const firebaseConfig = {
    apiKey: "AIzaSyB7Mt4NsiXOam36i5MgClhKa-IOimlQ4DE",
    authDomain: "gestaoutihnss.firebaseapp.com",
    projectId: "gestaoutihnss",
    storageBucket: "gestaoutihnss.firebasestorage.app",
    messagingSenderId: "664272211913",
    appId: "1:664272211913:web:66e30e6670126b3e51a218",
    databaseURL: "https://gestaoutihnss-default-rtdb.firebaseio.com"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let pacientes = {};
let evolucoes = {};

// ========== NAVEGA√á√ÉO ==========

function mostrarSecao(secao) {
    document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
    
    if (secao === 'admissao') {
        document.getElementById('secao_admissao').classList.remove('hidden');
    } else if (secao === 'evolucao') {
        document.getElementById('secao_evolucao').classList.remove('hidden');
        carregarPacientes();
    } else if (secao === 'historico') {
        document.getElementById('secao_historico').classList.remove('hidden');
        carregarPacientes();
        carregarHistorico();
    }
}

// ========== ADMISS√ÉO ==========

function salvarAdmissao() {
    const nome = document.getElementById('nome_pac').value.trim();
    const idade = document.getElementById('idade_pac').value;
    const dataAdm = document.getElementById('data_admissao').value;
    const leito = document.getElementById('leito_pac').value;
    const diagnostico = document.getElementById('diagnostico_adm').value.trim();
    const plano = document.getElementById('plano_inicial').value.trim();
    
    if (!nome || !idade || !dataAdm || !leito || !diagnostico) {
        mostrarStatus('status_save', 'Preencha todos os campos obrigat√≥rios!', 'error');
        return;
    }
    
    const paciente = {
        nome: nome,
        idade: parseInt(idade),
        dataAdmissao: dataAdm,
        leito: leito,
        diagnostico: diagnostico,
        planoInicial: plano,
        dataRegistro: new Date().toISOString(),
        ativo: true
    };
    
    db.ref('pacientesUTI').push(paciente)
        .then(() => {
            mostrarStatus('status_save', '‚úÖ Admiss√£o registrada com sucesso!', 'success');
            limparFormAdmissao();
        })
        .catch(error => {
            mostrarStatus('status_save', '‚ùå Erro ao salvar: ' + error.message, 'error');
        });
}

function limparFormAdmissao() {
    document.getElementById('nome_pac').value = '';
    document.getElementById('idade_pac').value = '';
    document.getElementById('data_admissao').value = '';
    document.getElementById('leito_pac').value = '';
    document.getElementById('diagnostico_adm').value = '';
    document.getElementById('plano_inicial').value = '';
}

// ========== EVOLU√á√ÉO ==========

function carregarPacientes() {
    db.ref('pacientesUTI').once('value').then(snapshot => {
        pacientes = {};
        const selPac = document.getElementById('sel_paciente');
        const filtroPac = document.getElementById('filtro_paciente');
        
        selPac.innerHTML = '<option value="">Selecione um paciente...</option>';
        filtroPac.innerHTML = '<option value="">Todos os pacientes</option>';
        
        snapshot.forEach(child => {
            const pac = child.val();
            if (pac.ativo) {
                pacientes[child.key] = pac;
                
                const opt1 = document.createElement('option');
                opt1.value = child.key;
                opt1.textContent = `${pac.nome} - Leito ${pac.leito}`;
                selPac.appendChild(opt1);
                
                const opt2 = document.createElement('option');
                opt2.value = child.key;
                opt2.textContent = `${pac.nome} - Leito ${pac.leito}`;
                filtroPac.appendChild(opt2);
            }
        });
    });
}

function carregarDadosPaciente() {
    const pacId = document.getElementById('sel_paciente').value;
    
    if (!pacId) {
        document.getElementById('nome_evo').value = '';
        document.getElementById('leito_evo').value = '';
        document.getElementById('dias_internacao').value = '';
        return;
    }
    
    const pac = pacientes[pacId];
    document.getElementById('nome_evo').value = pac.nome;
    document.getElementById('leito_evo').value = pac.leito;
    
    const dataAdm = new Date(pac.dataAdmissao);
    const hoje = new Date();
    const dias = Math.floor((hoje - dataAdm) / (1000 * 60 * 60 * 24));
    document.getElementById('dias_internacao').value = `${dias} dias`;
    
    // Setar data atual
    document.getElementById('data_evo').value = hoje.toISOString().split('T')[0];
}

function salvarEvolucao() {
    const pacId = document.getElementById('sel_paciente').value;
    
    if (!pacId) {
        mostrarStatus('status_evo_save', 'Selecione um paciente!', 'error');
        return;
    }
    
    const evolucao = {
        pacienteId: pacId,
        pacienteNome: document.getElementById('nome_evo').value,
        leito: document.getElementById('leito_evo').value,
        dataEvolucao: document.getElementById('data_evo').value,
        estadoGeral: document.getElementById('estado_geral').value,
        pa: document.getElementById('pa').value,
        fc: document.getElementById('fc').value,
        fr: document.getElementById('fr').value,
        temp: document.getElementById('temp').value,
        sat: document.getElementById('sat').value,
        evolucaoClinica: document.getElementById('evolucao_clinica').value,
        conduta: document.getElementById('conduta').value,
        dataRegistro: new Date().toISOString()
    };
    
    if (!evolucao.dataEvolucao || !evolucao.evolucaoClinica) {
        mostrarStatus('status_evo_save', 'Preencha os campos obrigat√≥rios!', 'error');
        return;
    }
    
    db.ref('evolucoesUTI').push(evolucao)
        .then(() => {
            mostrarStatus('status_evo_save', '‚úÖ Evolu√ß√£o salva com sucesso!', 'success');
            limparFormEvolucao();
        })
        .catch(error => {
            mostrarStatus('status_evo_save', '‚ùå Erro ao salvar: ' + error.message, 'error');
        });
}

function limparFormEvolucao() {
    document.getElementById('estado_geral').value = '';
    document.getElementById('pa').value = '';
    document.getElementById('fc').value = '';
    document.getElementById('fr').value = '';
    document.getElementById('temp').value = '';
    document.getElementById('sat').value = '';
    document.getElementById('evolucao_clinica').value = '';
    document.getElementById('conduta').value = '';
}

// ========== HIST√ìRICO ==========

function carregarHistorico() {
    const filtro = document.getElementById('filtro_paciente').value;
    
    db.ref('evolucoesUTI').once('value').then(snapshot => {
        const lista = document.getElementById('evoHistoryList');
        lista.innerHTML = '';
        
        const evoArray = [];
        snapshot.forEach(child => {
            const evo = child.val();
            evo.id = child.key;
            evoArray.push(evo);
        });
        
        // Ordenar por data decrescente
        evoArray.sort((a, b) => new Date(b.dataEvolucao) - new Date(a.dataEvolucao));
        
        // Filtrar se necess√°rio
        const evosFiltradas = filtro ? evoArray.filter(e => e.pacienteId === filtro) : evoArray;
        
        if (evosFiltradas.length === 0) {
            lista.innerHTML = '<p style="text-align: center; color: #666;">Nenhuma evolu√ß√£o encontrada.</p>';
            return;
        }
        
        evosFiltradas.forEach(evo => {
            const div = document.createElement('div');
            div.className = 'evo-item';
            div.innerHTML = `
                <h4>${evo.pacienteNome} - Leito ${evo.leito}</h4>
                <p><strong>Data:</strong> ${new Date(evo.dataEvolucao).toLocaleDateString('pt-BR')}</p>
                <p><strong>Estado Geral:</strong> ${evo.estadoGeral || 'N√£o informado'}</p>
                <p><strong>Evolu√ß√£o:</strong> ${evo.evolucaoClinica}</p>
                ${evo.conduta ? `<p><strong>Conduta:</strong> ${evo.conduta}</p>` : ''}
                <div class="evo-actions no-print">
                    <button class="danger" onclick="excluirEvolucao('${evo.id}')">üóëÔ∏è Excluir</button>
                </div>
            `;
            lista.appendChild(div);
        });
    });
}

function excluirEvolucao(id) {
    if (!confirm('Tem certeza que deseja excluir esta evolu√ß√£o?')) return;
    
    db.ref(`evolucoesUTI/${id}`).remove()
        .then(() => {
            alert('‚úÖ Evolu√ß√£o exclu√≠da!');
            carregarHistorico();
        })
        .catch(error => {
            alert('‚ùå Erro ao excluir: ' + error.message);
        });
}

// ========== UTILIDADES ==========

function mostrarStatus(elementId, mensagem, tipo) {
    const el = document.getElementById(elementId);
    el.textContent = mensagem;
    el.className = tipo;
    
    setTimeout(() => {
        el.style.display = 'none';
    }, 5000);
}

// ========== INICIALIZA√á√ÉO ==========

document.addEventListener('DOMContentLoaded', () => {
    // Mostrar se√ß√£o de admiss√£o por padr√£o
    mostrarSecao('admissao');
    
    // Setar data atual
    const hoje = new Date().toISOString().split('T')[0];
    document.getElementById('data_admissao').value = hoje;
    document.getElementById('data_evo').value = hoje;
});
</script>

</body>
</html>
